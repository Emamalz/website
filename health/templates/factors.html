{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Factors - Health Check</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50 font-sans text-gray-800 flex flex-col min-h-screen">

  <!-- Header -->
  <header class="bg-white shadow">
    <nav class="navbar max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
      <div class="logo flex items-center gap-2">
        <img src="{% static 'Images/logo.png' %}" alt="Logo" class="h-12">
        <span class="text-2xl font-bold">Health Check</span>
      </div>
      <ul class="navLinks flex gap-6 text-lg font-semibold">
        <li><a href="/" class="hover:text-blue-600">Home</a></li>
        <li><a href="/health/" class="hover:text-blue-600">Health</a></li>
        <li><a href="/trends/" class="text-blue-700">Trends</a></li>
      </ul>
    </nav>
  </header>

  <!-- Main -->
  <main class="flex-grow pb-32">
    <div class="max-w-5xl mx-auto text-center mt-10">
      <h1 class="text-3xl font-bold mb-4">Team: {{ team_name }}</h1>
    </div>
    <div id="charts" class="max-w-5xl mx-auto text-center mt-10 space-y-12 grid grid-cols-1 md:grid-cols-2 gap-8 px-4">
      <!-- JS will inject charts here -->
    </div>
  </main>

  <footer class="py-4 text-center text-sm text-gray-600">
    <small>&copy; 2025 Sky Engineering â€“ Health Check</small>
  </footer>

  <!-- Charts JS -->
  <script>
    window.onload = function () {
      const factorData = {{ factor_data }};
      const container = document.getElementById('charts');

      Object.entries(factorData).forEach(([factorName, counts], index) => {
        const canvasId = `chart-${index}`;
        const wrapper = document.createElement('div');
        wrapper.className = "bg-white p-6 rounded-lg shadow-lg";
        wrapper.innerHTML = `
          <h2 class="text-xl font-semibold mb-4">${factorName}</h2>
          <canvas id="${canvasId}" height="150"></canvas>
        `;
        container.appendChild(wrapper);

        const ctx = document.getElementById(canvasId).getContext('2d');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: ['Green', 'Amber', 'Red'],
            datasets: [{
              label: factorName,
              data: [counts.Green, counts.Amber, counts.Red],
              backgroundColor: ['#4ade80', '#facc15', '#f87171'],
              borderRadius: 10
            }]
          },
          options: {
            indexAxis: 'y',
            plugins: { legend: { display: false } },
            scales: { x: { beginAtZero: true } }
          }
        });
      });
    };
  </script>

</body>
</html>
